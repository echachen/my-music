<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å’Œå¹³ä¹‹ååœ£ä¹åˆ†äº«</title>

<link rel="stylesheet" href="https://unpkg.com/shikwasa/dist/shikwasa.min.css">
<script src="https://unpkg.com/shikwasa/dist/shikwasa.min.js"></script>

<style>
body {
    margin: 0;
    background: linear-gradient(-45deg,#ee7752,#e73c7e,#23a6d5,#23d5ab);
    background-size: 400% 400%;
    animation: gradient 15s ease infinite;
    font-family: system-ui;
    display: flex;
    justify-content: center;
    padding-top: 20px;
    min-height: 100vh;
}
@keyframes gradient {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
.main-card {
    width: 95%;
    max-width: 500px;
    background: rgba(255,255,255,.06);
    backdrop-filter: blur(12px);
    border-radius: 25px;
    padding: 20px;
    color: #fff;
}
.header { text-align: center; margin-bottom: 10px; }
#playlist { max-height: 350px; overflow-y: auto; }
.song {
    padding: 8px 10px;
    border-radius: 8px;
    cursor: pointer;
    opacity: .85;
}
.song:hover { background: rgba(255,255,255,.1); }
.song.active {
    background: rgba(31,58,138,.4);
    opacity: 1;
    font-weight: bold;
}
</style>
</head>

<body>

<div class="main-card">
    <div class="header">
        <h2>ğŸµ å’Œå¹³ä¹‹ååœ£ä¹åˆ†äº«</h2>
        <p id="status" style="font-size:11px;opacity:.6">è¿æ¥ä¸­...</p>
    </div>

    <div id="player"></div>
    <div id="playlist"></div>
</div>

<script>
const JSON_URL = 'https://cdn.jsdelivr.net/gh/echachen/my-music/songlist.json';

async function init() {
    const status = document.getElementById('status');
    const listEl = document.getElementById('playlist');

    try {
        const res = await fetch(JSON_URL + '?t=' + Date.now());
        if (!res.ok) throw new Error('fetch failed');

        const raw = await res.json();

        // âœ… APlayer â†’ Shikwasa æ ¼å¼è½¬æ¢
        const songs = raw.map(s => ({
            title: s.name,
            artist: '',
            cover: s.cover || '',
            src: s.src
        }));

        let index = 0;

        const player = new Shikwasa({
            container: document.getElementById('player'),
            audio: songs[0],
            themeColor: '#1f3a8a',
            autoplay: false
        });

        listEl.innerHTML = songs.map((s,i)=>`
            <div class="song" data-i="${i}">${i+1}. ${s.title}</div>
        `).join('');

        function setActive(i){
            document.querySelectorAll('.song').forEach(e=>e.classList.remove('active'));
            document.querySelector(`.song[data-i="${i}"]`)?.classList.add('active');
        }

        listEl.onclick = e => {
            const item = e.target.closest('.song');
            if (!item) return;
            index = +item.dataset.i;
            player.update({ audio: songs[index] });
            player.play();
            setActive(index);
        };

        player.on('ended', ()=>{
            index = (index + 1) % songs.length;
            player.update({ audio: songs[index] });
            player.play();
            setActive(index);
        });

        setActive(0);
        status.innerText = `å·²åŠ è½½ ${songs.length} é¦–åœ£ä¹`;

    } catch (e) {
        console.error(e);
        status.innerText = 'âŒ JSON æ— æ³•è§£æ';
    }
}

init();
</script>

</body>
</html>
