<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>å’Œå¹³ä¹‹ååœ£ä¹åˆ†äº« - Shikwasaç‰ˆ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shikwasa/dist/shikwasa.min.css">
    <script src="https://cdn.jsdelivr.net/npm/shikwasa/dist/shikwasa.min.js"></script>
    <style>
        /* 1. åŠ¨æ€æ¸å˜èƒŒæ™¯ (ä¿ç•™ä½ çš„æœ€çˆ±) */
        body { 
            margin: 0; 
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            font-family: 'Segoe UI', system-ui, sans-serif; 
            display: flex; justify-content: center; align-items: flex-start; 
            padding-top: 20px; min-height: 100vh; 
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 2. æç®€ç£¨ç ‚ç»ç’ƒå¡ç‰‡ */
        .main-card { 
            width: 95%; max-width: 500px; 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 30px 20px; border-radius: 30px; 
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15); 
        }

        .header { color: white; text-align: center; margin-bottom: 25px; }
        .header h2 { font-weight: 300; font-size: 1.3rem; margin: 0; }

        /* 3. Shikwasa æ ·å¼è‡ªå®šä¹‰ (åœ£æ¯è“é…è‰²) */
        .shikwasa { 
            background: rgba(255,255,255,0.15) !important; 
            border-radius: 20px !important; 
            box-shadow: none !important;
            color: #fff !important;
        }
        .shikwasa .shikwasa-controls .shikwasa-bar { background: rgb(31, 58, 138) !important; }

        /* 4. å…³é”®ï¼šä½ å¯ä»¥ç²¾å‡†æ§åˆ¶çš„â€œé—´è·â€ */
        .playlist-container {
            margin-top: 40px; /* ğŸ‘ˆ æ”¹è¿™é‡Œï¼æƒ³è¦æ ‡é¢˜å’Œæ›²åº“å¤šè¿œï¼Œå°±æ”¹è¿™ä¸ªæ•°å­— */
            max-height: 350px;
            overflow-y: auto;
            scrollbar-width: thin;
        }

        /* 5. æ¼‚äº®çš„æ›²åº“åˆ—è¡¨æ ·å¼ */
        .music-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            transition: all 0.3s;
            display: flex; align-items: center;
        }
        .music-item:hover { background: rgba(255, 255, 255, 0.15); }
        .music-item.active { 
            background: rgba(31, 58, 138, 0.6); 
            border-left: 4px solid #fff; 
            padding-left: 11px;
        }
        .music-item span { font-size: 14px; }

        #status { font-size: 11px; opacity: 0.6; margin-top: 10px; text-align: center; color: white; }
    </style>
</head>
<body>

<div class="main-card">
    <div class="header">
        <h2>ğŸµ å’Œå¹³ä¹‹ååœ£ä¹åˆ†äº«</h2>
        <p id="status">è¿æ¥äº‘ç«¯ä¸­...</p>
    </div>

    <div id="player"></div>

    <div class="playlist-container" id="playlist"></div>
</div>

<script>
    const CONFIG = {
        owner: 'echachen',
        repo: 'my-music',
        defaultCover: 'https://via.placeholder.com/300/ffffff/1a73e8?text=Church+Music'
    };

    let player = null;
    let musicData = [];

    async function initStation() {
        const statusEl = document.getElementById('status');
        const playlistEl = document.getElementById('playlist');

        try {
            // è·å–æ­Œæ›²åˆ—è¡¨ (å·²å»æ‰æ—¶é—´æˆ³ï¼ŒèŠ‚çœAPIé¢åº¦)
            const resp = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/`);
            if (!resp.ok) throw new Error();
            const files = await resp.json();
            
            musicData = files
                .filter(f => f.name.toLowerCase().endsWith('.mp3'))
                .map(f => ({
                    title: f.name.replace(/\.mp3$/i, ''),
                    src: f.download_url,
                    cover: CONFIG.defaultCover
                }));

            if (musicData.length === 0) return;

            // 1. åˆå§‹åŒ– Shikwasa æ’­æ”¾å™¨ (é¦–é€‰ç¬¬ä¸€é¦–)
            player = new Shikwasa({
                container: document.getElementById('player'),
                audio: musicData[0],
                themeColor: '#1f3a8a'
            });

            // 2. æ¸²æŸ“æ›²åº“åˆ—è¡¨
            renderPlaylist();

            statusEl.innerText = `å·²æˆåŠŸåŠ è½½ ${musicData.length} é¦–äº‘ç«¯æ­Œæ›²`;
        } catch (err) {
            statusEl.innerText = "åŒæ­¥å¤±è´¥ï¼Œè¯·ç­‰ä¸€å°æ—¶åé‡è¯•";
        }
    }

    function renderPlaylist() {
        const playlistEl = document.getElementById('playlist');
        playlistEl.innerHTML = musicData.map((song, index) => `
            <div class="music-item ${index === 0 ? 'active' : ''}" onclick="playSong(${index})">
                <span>${song.title}</span>
            </div>
        `).join('');
    }

    function playSong(index) {
        // æ›´æ–°æ’­æ”¾å™¨å†…å®¹
        player.update({ audio: musicData[index] });
        player.play();

        // æ›´æ–°åˆ—è¡¨é«˜äº®çŠ¶æ€
        const items = document.querySelectorAll('.music-item');
        items.forEach(it => it.classList.remove('active'));
        items[index].classList.add('active');

        // è‡ªåŠ¨å°†é€‰ä¸­çš„æ­Œæ»šåŠ¨åˆ°è§†çª—ä¸­å¿ƒ (è¿™æ¬¡ç»å¯¹ç²¾å‡†ï¼)
        items[index].scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    initStation();
</script>
</body>
</html>
